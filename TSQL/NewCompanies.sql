Use Hackerrank;

/*
Write a query to print:
	company_code, 
	founder name, 
	Nbr number of lead managers, 
	Nbr number of senior managers, 
	Nbr number of managers, 
	Nbr number of employees. 
Order your output by ascending company_code.
*/

-- ****************************************************************

DROP TABLE COMPANY;

CREATE TABLE COMPANY (
	COMPANY_CODE	VARCHAR(10), 
	FOUNDER			VARCHAR(20)
)
;

INSERT INTO COMPANY VALUES ('C1', 'Monika');
INSERT INTO COMPANY VALUES ('C2', 'Samantha');

SELECT DISTINCT * FROM COMPANY ORDER BY COMPANY_CODE;

Exec sp_columns COMPANY;

-- ****************************************************************

DROP TABLE LEAD_MANAGER;

CREATE TABLE LEAD_MANAGER (
	LEAD_MANAGER_CODE	VARCHAR(10), 
	COMPANY_CODE		VARCHAR(10)
)
;

INSERT INTO LEAD_MANAGER VALUES ('LM1', 'C1');
INSERT INTO LEAD_MANAGER VALUES ('LM2', 'C2');

INSERT INTO LEAD_MANAGER VALUES ('LM1', 'C1');
INSERT INTO LEAD_MANAGER VALUES ('LM2', 'C2');

SELECT DISTINCT * FROM LEAD_MANAGER ORDER BY COMPANY_CODE;

Exec sp_columns LEAD_MANAGER;

-- ****************************************************************

DROP TABLE SENIOR_MANAGER;

CREATE TABLE SENIOR_MANAGER (
	SENIOR_MANAGER_CODE	VARCHAR(10), 
	LEAD_MANAGER_CODE	VARCHAR(10), 
	COMPANY_CODE		VARCHAR(10)
)
;

INSERT INTO SENIOR_MANAGER VALUES ('SM1', 'LM1', 'C1');
INSERT INTO SENIOR_MANAGER VALUES ('SM2', 'LM1', 'C1');
INSERT INTO SENIOR_MANAGER VALUES ('SM3', 'LM2', 'C2');

INSERT INTO SENIOR_MANAGER VALUES ('SM1', 'LM1', 'C1');
INSERT INTO SENIOR_MANAGER VALUES ('SM2', 'LM1', 'C1');
INSERT INTO SENIOR_MANAGER VALUES ('SM3', 'LM2', 'C2');

SELECT DISTINCT * FROM SENIOR_MANAGER ORDER BY COMPANY_CODE;

Exec sp_columns SENIOR_MANAGER;

-- ****************************************************************

DROP TABLE MANAGER;

CREATE TABLE MANAGER (
	MANAGER_CODE		VARCHAR(10), 
	SENIOR_MANAGER_CODE	VARCHAR(10), 
	LEAD_MANAGER_CODE	VARCHAR(10), 
	COMPANY_CODE		VARCHAR(10)
)
;

INSERT INTO MANAGER VALUES ('M1', 'SM1', 'LM1', 'C1');
INSERT INTO MANAGER VALUES ('M2', 'SM3', 'LM2', 'C2');
INSERT INTO MANAGER VALUES ('M3', 'SM3', 'LM2', 'C2');

INSERT INTO MANAGER VALUES ('M1', 'SM1', 'LM1', 'C1');
INSERT INTO MANAGER VALUES ('M2', 'SM3', 'LM2', 'C2');
INSERT INTO MANAGER VALUES ('M3', 'SM3', 'LM2', 'C2');

SELECT DISTINCT * FROM MANAGER ORDER BY COMPANY_CODE;

Exec sp_columns MANAGER;

-- ****************************************************************

DROP TABLE EMPLOYEE;

CREATE TABLE EMPLOYEE (
	EMPLOYEE_CODE		VARCHAR(10), 
	MANAGER_CODE		VARCHAR(10), 
	SENIOR_MANAGER_CODE	VARCHAR(10), 
	LEAD_MANAGER_CODE	VARCHAR(10), 
	COMPANY_CODE		VARCHAR(10)
)
;

INSERT INTO EMPLOYEE VALUES ('E1', 'M1', 'SM1', 'LM1', 'C1');
INSERT INTO EMPLOYEE VALUES ('E2', 'M1', 'SM1', 'LM1', 'C1');
INSERT INTO EMPLOYEE VALUES ('E3', 'M2', 'SM3', 'LM2', 'C2');
INSERT INTO EMPLOYEE VALUES ('E4', 'M3', 'SM3', 'LM2', 'C2');

INSERT INTO EMPLOYEE VALUES ('E1', 'M1', 'SM1', 'LM1', 'C1');
INSERT INTO EMPLOYEE VALUES ('E2', 'M1', 'SM1', 'LM1', 'C1');
INSERT INTO EMPLOYEE VALUES ('E3', 'M2', 'SM3', 'LM2', 'C2');
INSERT INTO EMPLOYEE VALUES ('E4', 'M3', 'SM3', 'LM2', 'C2');

SELECT DISTINCT * FROM EMPLOYEE ORDER BY COMPANY_CODE;

Exec sp_columns EMPLOYEE;

-- ****************************************************************

SELECT DISTINCT 
	C.COMPANY_CODE, 
	C.FOUNDER 
FROM COMPANY C 
ORDER BY COMPANY_CODE 
;

/*
C1	Monika
C2	Samantha
*/

-- ****************************************************************

SELECT DISTINCT 
	C.COMPANY_CODE, 
	C.FOUNDER, 
	LM.LEAD_MANAGER_CODE
FROM COMPANY C 
JOIN LEAD_MANAGER LM ON LM.COMPANY_CODE = C.COMPANY_CODE 
ORDER BY COMPANY_CODE 
;

/*
C1	Monika	LM1
C2	Samantha	LM2
*/

-- ****************************************************************

SELECT DISTINCT 
	C.COMPANY_CODE, 
	C.FOUNDER, 
	SM.SENIOR_MANAGER_CODE 
FROM COMPANY C 
JOIN SENIOR_MANAGER SM ON SM.COMPANY_CODE = C.COMPANY_CODE 
ORDER BY COMPANY_CODE 
;

/*
C1	Monika	SM1
C1	Monika	SM2
C2	Samantha	SM3
*/

-- ****************************************************************

SELECT DISTINCT 
	C.COMPANY_CODE, 
	C.FOUNDER, 
	M.MANAGER_CODE 
FROM COMPANY C 
JOIN MANAGER M ON M.COMPANY_CODE = C.COMPANY_CODE 
ORDER BY COMPANY_CODE 
;

/*
C1	Monika	M1
C2	Samantha	M2
C2	Samantha	M3
*/

-- ****************************************************************

SELECT DISTINCT 
	C.COMPANY_CODE, 
	C.FOUNDER, 
	E.EMPLOYEE_CODE 
FROM COMPANY C 
JOIN EMPLOYEE E ON E.COMPANY_CODE = C.COMPANY_CODE 
ORDER BY COMPANY_CODE 
;

/*
C1	Monika	E1
C1	Monika	E2
C2	Samantha	E3
C2	Samantha	E4
*/

-- ****************************************************************

WITH 

RESULT_LM AS (
	SELECT DISTINCT 
		C.COMPANY_CODE AS COMPANY_CODE_LM 
		,LM.LEAD_MANAGER_CODE AS LEAD_MANAGER_CODE_LM
	FROM COMPANY C 
	JOIN LEAD_MANAGER LM ON LM.COMPANY_CODE = C.COMPANY_CODE 
) 
, RESULT_LMC AS (
	SELECT  
		C.COMPANY_CODE AS COMPANY_CODE_LMC 
		,COUNT(RLM.LEAD_MANAGER_CODE_LM) AS NBR_LEAD_MANAGERS_LMC 
	FROM COMPANY C 
	JOIN RESULT_LM RLM ON RLM.COMPANY_CODE_LM = C.COMPANY_CODE 
	GROUP BY 
		C.COMPANY_CODE
) 

, 
RESULT_SM AS (
	SELECT DISTINCT 
		C.COMPANY_CODE AS COMPANY_CODE_SM 
		,SM.SENIOR_MANAGER_CODE AS SENIOR_MANAGER_CODE_SM
	FROM COMPANY C 
	JOIN SENIOR_MANAGER SM ON SM.COMPANY_CODE = C.COMPANY_CODE 
) 
, RESULT_SMC AS (
	SELECT  
		C.COMPANY_CODE AS COMPANY_CODE_SMC 
		,COUNT(RSM.SENIOR_MANAGER_CODE_SM) AS NBR_SENIOR_MANAGERS_SMC 
	FROM COMPANY C 
	JOIN RESULT_SM RSM ON RSM.COMPANY_CODE_SM = C.COMPANY_CODE 
	GROUP BY 
		C.COMPANY_CODE
) 

, 
RESULT_M AS (
	SELECT DISTINCT 
		C.COMPANY_CODE AS COMPANY_CODE_M 
		,M.MANAGER_CODE AS MANAGER_CODE_M
	FROM COMPANY C 
	JOIN MANAGER M ON M.COMPANY_CODE = C.COMPANY_CODE 
) 
, RESULT_MC AS (
	SELECT  
		C.COMPANY_CODE AS COMPANY_CODE_MC 
		,COUNT(RM.MANAGER_CODE_M) AS NBR_MANAGERS_MC 
	FROM COMPANY C 
	JOIN RESULT_M RM ON RM.COMPANY_CODE_M = C.COMPANY_CODE 
	GROUP BY 
		C.COMPANY_CODE
) 

, 
RESULT_E AS (
	SELECT DISTINCT 
		C.COMPANY_CODE AS COMPANY_CODE_E 
		,E.EMPLOYEE_CODE AS EMPLOYEE_CODE_E
	FROM COMPANY C 
	JOIN EMPLOYEE E ON E.COMPANY_CODE = C.COMPANY_CODE 
) 
, RESULT_EC AS (
	SELECT  
		C.COMPANY_CODE AS COMPANY_CODE_EC 
		,COUNT(RE.EMPLOYEE_CODE_E) AS NBR_EMPLOYEES_EC 
	FROM COMPANY C 
	JOIN RESULT_E RE ON RE.COMPANY_CODE_E = C.COMPANY_CODE 
	GROUP BY 
		C.COMPANY_CODE
) 

SELECT 
	 C.COMPANY_CODE
	 ,C.FOUNDER 
	 ,RLMC.NBR_LEAD_MANAGERS_LMC 
	 ,RSMC.NBR_SENIOR_MANAGERS_SMC 
	 ,RMC.NBR_MANAGERS_MC 
	 ,REC.NBR_EMPLOYEES_EC 
FROM COMPANY C 
JOIN RESULT_LMC RLMC ON RLMC.COMPANY_CODE_LMC = C.COMPANY_CODE 
JOIN RESULT_SMC RSMC ON RSMC.COMPANY_CODE_SMC = C.COMPANY_CODE 
JOIN RESULT_MC RMC ON RMC.COMPANY_CODE_MC = C.COMPANY_CODE 
JOIN RESULT_EC REC ON REC.COMPANY_CODE_EC = C.COMPANY_CODE 
ORDER BY C.COMPANY_CODE 
;
